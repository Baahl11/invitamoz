(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[235],{1797:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/[locale]/login",function(){return t(2503)}])},2503:function(e,r,t){"use strict";t.r(r),t.d(r,{__N_SSP:function(){return ed},default:function(){return eu}});var i=t(5893);t(4354),t(3454);var o=t(7294),s=t(6485),a=t(8747),l=t(4508),n=t(2068),d=t(1163),u=t(1677),c=t(1127),h=t(8810),p=t(9798),_=t(3342),b=t(7253),g=t(5581),w=t(8558),x=t(2752),f=t(5131);let C=[":","&","'","`","\xb4","&quot"],m=e=>C.reduce((r,t)=>(e.includes(t)&&r.push(t),r),[]).join(""),j=e=>C.some(r=>e.includes(r));var v=t(182);let k=e=>{let{id:r,state:t,onChange:o,onTouched:s,showError:a,isDisabled:l}=e,n=(0,x.T)(),{value:d,error:u}=t;return(0,i.jsxs)(v.o,{label:n("inputEmailOrUsername"),labelFor:r,children:[(0,i.jsx)(g.y,{disabled:l,value:d,onChange:e=>{o(e.target.value)},onBlur:s,id:r,type:"text",error:a&&!!u,"aria-invalid":a&&!!u,autoCapitalize:"off",autoComplete:"username",spellCheck:!1,autoCorrect:"off","aria-describedby":a&&u?"".concat(r,"-error"):void 0,"data-testid":"login-username"}),a&&u&&(0,i.jsx)(w.C,{error:!0,"data-testid":"".concat(r,"-error"),id:"".concat(r,"-error"),role:"alert","aria-live":"polite",children:(e=>{switch(e){case f.sW.InvalidCharacters:return n("errorUsernameInvalidCharacters",{forbiddenChars:(0,i.jsx)("strong",{children:m(d)})});case f.sW.InvalidCredentials:return n("passwordless_errorInvalidCredentials");case f.ON.Required:return n("errorUsernameRequired");default:return e}})(u)})]})},P=e=>{let{id:r,state:t,onChange:o,onTouched:s,showError:a,isDisabled:l}=e,d=(0,x.T)(),{value:u,error:c}=t;return(0,i.jsxs)(v.o,{label:d("inputPassword"),labelFor:r,children:[(0,i.jsx)(n.WU,{id:r,autoComplete:"current-password",value:u,disabled:l,onChange:o,onBlur:s,error:a&&!!c,"aria-invalid":a&&!!c,"aria-describedby":a&&c?"".concat(r,"-error"):void 0,spellCheck:!1,autoCorrect:"off",autoCapitalize:"off",ariaHidePassword:d("hidePassword"),ariaPasswordHidden:d("passwordHidden"),ariaPasswordVisible:d("passwordVisible"),ariaShowPassword:d("showPassword"),"data-testid":"login-password"}),a&&c&&(0,i.jsx)(w.C,{error:!0,"data-testid":"".concat(r,"-error"),id:"".concat(r,"-error"),role:"alert","aria-live":"polite",children:c===f.ON.Required?d("errorPasswordRequired"):c})]})},y=e=>{let{id:r,state:t,onChange:o,onTouched:s,isDisabled:a}=e,{value:l}=t;return(0,i.jsx)(v.o,{label:"Automation key",labelFor:r,children:(0,i.jsx)(g.y,{id:r,"data-testid":"login-automationKey",type:"text",onChange:e=>{o(e.target.value)},onBlur:s,value:l,disabled:a})})};var E=t(4735),q=t(1686),R=t(4629),S=t(6757),A=t(558);let I=e=>{let{hide:r,isVisible:t}=e,s=(0,x.T)(),u=(0,l.cl)(),{query:c}=(0,d.useRouter)(),_=(0,h.K4)();(0,A.E)(t),(0,o.useEffect)(()=>{t&&_((0,p.N9)())},[t]);let b=o.useCallback(()=>{_((0,p.cb)()),r()},[r]);return(0,i.jsx)(n.IC,{title:s("hbx_retry_dialog_title"),description:s("hbx_retry_dialog_description"),buttons:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(a.D,{onClick:()=>{_((0,p.KO)(""));let e=(0,S.X)({query:c,flowId:u});window.open(e)},children:s("hbx_retry_dialog_retry_button")}),(0,i.jsx)(R.P,{onClick:()=>{let e="https://support.spotify.com/article/contact-us/";_((0,p.Dx)(e)),window.open(e,"_blank")},children:s("hbx_retry_dialog_contact_support_button")}),(0,i.jsx)(E.o,{onClick:b,children:s("hbx_retry_dialog_cancel_button")})]}),isVisible:t,onHide:b})},F=q.ZP.div.withConfig({componentId:"sc-8622bdb3-0"})(["margin-block-start:auto;text-align:center;"]),T=()=>{let e=(0,x.T)(),{isVisible:r,show:t,hide:o}=(0,n.bZ)();return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(F,{children:(0,i.jsx)(E.o,{onClick:t,type:"button",children:e("hbx_support_fallback_button")})}),(0,i.jsx)(I,{isVisible:r,hide:o})]})};var H=t(3089),N=t(4075),U=t(5258),L=t(5596),O=t(2051);let V=e=>{let{error:r,isVisible:t,continueUrl:s,hide:u}=e,c=(0,x.T)(),_=(0,h.K4)(),b=(0,d.useRouter)(),{query:g}=b,w=(0,l.cl)(),f=(0,O.i)(s,{query:g,flowId:w}),C=function(e){switch(e){case L.q.FacebookAccountError:return"Facebook";case L.q.GoogleAccount:return"Google";case L.q.AppleAccountError:return"Apple";default:return"?"}}(r);(0,o.useEffect)(()=>{t&&_((0,p.Ze)(C))},[t,_,C]);let m=o.useCallback(()=>{_((0,p.MY)(C)),u()},[u,_,C]),j=o.useCallback(()=>{_((0,p.fo)(C));let{[N.d.Error]:e,...r}=g;b.replace({pathname:b.pathname,query:r},void 0,{shallow:!0}),u()},[u,_,C,g,b]),v=o.useCallback(()=>{_((0,p.oy)(C))},[_,C]);return(0,i.jsx)(n.IC,{title:c("idp_error_dialog_title"),description:c("idp_error_dialog_description",{provider:C}),buttons:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(a.D,{onClick:j,children:c("idp_error_dialog_login_another_way")}),(0,i.jsx)(R.P,{onClick:v,href:f,children:c("idp_error_dialog_signup")})]}),isVisible:t,onHide:m})},B=[L.q.FacebookAccountError,L.q.AppleAccountError,L.q.GoogleAccount];var K=t(1661),M=t(3362);let W=e=>{let r=(0,M.a)(e);return(0,K.$)("/login",{...r,[N.d.AllowPassword]:void 0},e)},Z=q.ZP.div.withConfig({componentId:"sc-28cc6081-0"})(["text-align:center;"]),D=()=>{let e=(0,h.K4)(),r=(0,x.T)(),t=(0,l.cl)(),{query:o}=(0,d.useRouter)(),s=W({query:o,flowId:t});return(0,i.jsx)(Z,{children:(0,i.jsx)("a",{href:s,children:(0,i.jsx)(E.o,{onClick:()=>{e((0,p.UZ)(s))},semanticColor:"textBase",children:r("loginWithoutPassword")})})})},X=(e,r)=>r||e?e?j(e)?f.sW.InvalidCharacters:null:f.ON.Required:null,z=(e,r)=>r||e?e?null:f.ON.Required:null;var G=t(1892),$=t(259),Q=t(4155);let Y=()=>{let{executeRecaptcha:e}=(0,$.xX)();return(0,o.useCallback)(async r=>Q.env.NEXT_PUBLIC_STUB_RECAPTCHA?"recaptchaToken":e?await e(r):void 0,[e])},J=(e,r)=>{let t={...(0,M.a)(r),[N.d.LoginHint]:e,[N.d.Method]:"password",[N.d.AllowPassword]:"1"};return(0,K.$)("/login",t,r)};var ee=t(8448),er=t(8231);let et=()=>"/login/password";var ei=t(9774);let eo=e=>{let{query:r}=e,t=(0,ei.e)(r,[N.d.MaxAge,N.d.Method,N.d.HulkbusterExperimentFlow]);return(0,K.$)("/login/otc/start",t,{...e,excludeLocale:!0})},es=async e=>{let{username:r,password:t,automationKey:i,remember:o,continueUrl:s,recaptchaToken:a,isPasswordless:l,flowId:n,query:d}=e,u=(0,er.l)(d,s),c={username:r.trim(),password:t,remember:o,automationKey:i,recaptchaToken:a,continue:s,flowCtx:n,client_id:u},h=l?eo({query:d}):et(),p=await (0,ee.Q)(h,c);if(null!==p.error)return{status:"error",error:p.error};if("result"in p.data&&"redirect_required"===p.data.result){var _;return{status:"redirect",url:(null===(_=p.data.data)||void 0===_?void 0:_.redirect_url)||""}}return{status:"success"}};var ea=t(5011);let el=e=>{let{allowPassword:r,isAutomated:t,errorFromQuery:i,loginHint:o,continueUrl:s,isPasswordless:a,query:l,flowId:n}=e,d=(0,h.K4)(),u=Y(),{state:c,data:_,isValid:b,fields:g,setState:w}=(0,G.c)({username:{initialValue:o||"",validate:X,isRequired:!0},password:{initialValue:"",isRequired:r,validate:z},automationKey:{initialValue:"",isRequired:!1}},{error:i||null});return{state:c,fields:g,onSubmit:async e=>{if(e.preventDefault(),d((0,p.I5)()),!b){w({showFieldErrors:!0});return}w({isLoading:!0,error:null});let r=await u("accounts/login");if(!t&&!r){w({isLoading:!1,error:L.q.RecaptchError});return}let i=await es({..._,remember:"true",continueUrl:s,recaptchaToken:r,isPasswordless:a,flowId:n,query:l});if("error"===i.status){d((0,p.tB)(i.error));let{error:e}=i;if(a)switch(e){case L.q.UnsupportedLoginMethod:{let e=J(_.username,{query:l,flowId:n});window.location.assign(e);return}case L.q.InvalidCredentials:w({isLoading:!1,showFieldErrors:!0,fields:{username:{error:f.sW.InvalidCredentials}}});return;default:w({error:e,isLoading:!1});return}w({error:e,isLoading:!1})}else"redirect"===i.status?(d((0,p.bM)(i.url)),window.location.assign(i.url)):"success"===i.status&&(d((0,p.py)()),(0,ea.e)(s))}}},en=()=>{let e=(0,x.T)(),r=(0,h.K4)(),t=(0,l.cl)(),s=(0,d.useRouter)(),{query:g}=s,w=(0,H.U)(N.d.Reason),f=(0,H.U)(N.d.LoginHint),C=(0,H.U)(N.d.Error),m=(0,U.k)(),j=(0,_.S)(b.P.AllowPassword),v=!j,E=(0,_.S)(b.P.OnlyPasswordView),q=(0,_.S)(b.P.SignupMode),R=(0,_.S)(b.P.IsAutomated),S=(0,_.S)(b.P.LoginWithPhone),A=(0,_.S)(b.P.Hbx),I=(0,_.S)(b.P.IsSlingshot),F=(0,_.S)(b.P.IsRu),L=(0,n.bZ)(),{state:O,fields:K,onSubmit:M}=el({allowPassword:j,isAutomated:R,errorFromQuery:C,loginHint:f,continueUrl:m,isPasswordless:v,query:g,flowId:t}),{error:W,isLoading:Z}=O,X=W&&B.includes(W)?W:null;return(0,o.useEffect)(()=>{r((0,p.MN)(w)),I&&console.log("This is a slingshot deployment!")},[]),(0,o.useEffect)(()=>{X&&L.show()},[X]),(0,i.jsxs)(u.d,{title:e(j?"password_login_page_title":"login_page_title"),hasBackButton:j,onClickBack:()=>{s.back()},isRu:F,showIdpSection:!E,isHbx:A,showLoginWithPhone:S,signupMode:q,continueUrl:m,children:[W&&!X&&(0,i.jsxs)(o.Fragment,{children:[(0,i.jsx)(c.H,{error:W,allowPassword:j}),(0,i.jsx)(n.O9,{height:"base"})]}),(0,i.jsxs)("form",{onSubmit:M,children:[(0,i.jsx)(k,{...K.username}),j&&(0,i.jsx)(P,{...K.password}),R&&(0,i.jsx)(y,{...K.automationKey}),(0,i.jsx)(a.D,{disabled:Z,type:"submit",style:{inlineSize:"100%"},"data-testid":"login-button",children:e(v?"passwordless_login_submit_button":"password_login_submit_button")})]}),j&&(0,i.jsxs)(o.Fragment,{children:[(0,i.jsx)(n.O9,{height:"looser-2"}),(0,i.jsx)(D,{})]}),g[N.d.HulkbusterExperimentFlow]&&(0,i.jsx)(T,{}),X&&(0,i.jsx)(V,{error:X,isVisible:L.isVisible,continueUrl:m,hide:L.hide})]})};var ed=!0,eu=e=>(0,i.jsx)(s.o,{...e,children:(0,i.jsx)(en,{})})}},function(e){e.O(0,[564,500,631,801,215,888,774,179],function(){return e(e.s=1797)}),_N_E=e.O()}]);